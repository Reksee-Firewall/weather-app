import "./styles.css";
import { Task } from "./Task.js";
import { subscribe } from "./observer.js";

var pageState = {
  publicKeyWeather: "T9V72F3KAEU68NHBDQNM5C335",
  locSearchParameter: "london",
  publicKeyGiphy: "NtNc7orE9l9uZDU0qRc69bP19gBk5ZUX",
  gifSearchParameter: "cats",
  weatherURL: `https://weather.visualcrossing.com/VisualCrossingWebServices/rest/services/timeline/location_parameter?key=public_key`,
  giphyURL: `https://api.giphy.com/v1/gifs/translate?api_key=public_key&s=search_parameter`,
};

const updateStateVariables = () => {
  pageState.weatherURL = `https://weather.visualcrossing.com/VisualCrossingWebServices/rest/services/timeline/location_parameter?key=public_key`;
  pageState.giphyURL = `https://api.giphy.com/v1/gifs/translate?api_key=public_key&s=search_parameter`;

  pageState.weatherURL = pageState.weatherURL.replace(
    "location_parameter",
    pageState.locSearchParameter
  );
  pageState.weatherURL = pageState.weatherURL.replace(
    "public_key",
    pageState.publicKeyWeather
  );
  pageState.giphyURL = pageState.giphyURL.replace(
    "search_parameter",
    pageState.gifSearchParameter
  );
  pageState.giphyURL = pageState.giphyURL.replace(
    "public_key",
    pageState.publicKeyGiphy
  );
};

const initializeEventListeners = () => {
  const btn = document.querySelector("button");
  btn.addEventListener("click", handleSearch);
};

function drawGiphy() {
  const img = document.querySelector("img");
  fetch(pageState.giphyURL, { mode: "cors" })
    .then(function (response) {
      return response.json();
    })
    .then(function (response) {
      img.src = response.data.images.original.url;
    });
}

function handleSearch() {
  const input = document.querySelector("input");
  if (!input.value) {
    drawGiphy();
    return;
  }
  pageState.gifSearchParameter = input.value;
  updateStateVariables();
  drawGiphy();
}

const initialize = (() => {
  updateStateVariables();
  initializeEventListeners();
  drawGiphy();
})();
